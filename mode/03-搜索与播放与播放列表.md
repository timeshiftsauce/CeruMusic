# 搜索与播放与播放列表

## 搜索

- 单曲搜索：输入关键词，分页加载，滚动触底自动加载下一页。
  - 代码参考：`src/renderer/src/views/music/search.vue:102-149`、滚动加载 `src/renderer/src/views/music/search.vue:203-211`。
- 歌单搜索：标签切换到“歌单”，分页加载并展示封面、标题、作者、曲目数与播放量。
  - 代码参考：`src/renderer/src/views/music/search.vue:213-261`、卡片渲染 `src/renderer/src/views/music/search.vue:344-392`。
- 切换音源：点击搜索框音源图标或在插件管理中选择音源，搜索会根据当前音源执行。

## 播放交互

- 双击播放：将歌曲插入当前播放项之后并立即播放。
- 单击加入：加入播放列表末尾。
- 事件触发：
  - 添加并播放：`src/renderer/src/views/music/search.vue:176-183`
  - 添加到末尾：`src/renderer/src/views/music/search.vue:196-201`
- 全局音频：播放、暂停、进度与时长管理在 `GlobalAudio` 组件中完成。
  - 代码参考：`src/renderer/src/components/Play/GlobalAudio.vue:172-186`

## 播放列表管理

- 添加到首位并播放：`src/renderer/src/utils/playlist/playlistManager.ts:86-128`
- 添加到末尾：`src/renderer/src/utils/playlist/playlistManager.ts:135-155`
- 替换整表并播放第一首：`src/renderer/src/utils/playlist/playlistManager.ts:163-199`
- 事件总线：全局 `mitt` 事件总线用于跨组件触发添加/替换等动作：`src/renderer/src/utils/playlist/playlistManager.ts:14-21`、`src/renderer/src/utils/playlist/playlistManager.ts:206-224`。
- 本地持久化：播放列表与用户设置存储于 `localStorage`：`src/renderer/src/store/LocalUserDetail.ts:15-37`、监听持久化 `src/renderer/src/store/LocalUserDetail.ts:44-63`。

## 歌单与播放列表的协作

- 在歌单卡片点击可进入歌单详情，并支持一键替换当前播放列表为歌单曲目：`src/renderer/src/views/music/search.vue:263-276`、`src/renderer/src/utils/playlist/playlistManager.ts:163-199`。

## 下载单曲

- 在歌曲项“下载”，选择音质后开始下载（若所选音质不可用自动回退到最高可用）。
  - 下载流程：`src/renderer/src/utils/audio/download.ts:155-173`、音质回退与提示 `src/renderer/src/utils/audio/download.ts:182-193`。

