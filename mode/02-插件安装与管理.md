# 插件安装与管理

## 插件类别

- 澜音插件（CR）：为澜音生态设计的标准化插件格式。
- 洛雪插件（LX）：兼容洛雪格式的插件（部分能力需适配）。

## 安装入口与导入方式

- 入口：设置 → 插件管理 → “添加插件”。
- 选择类别：CR 或 LX（默认 CR）。`src/renderer/src/components/Settings/plugins.vue:25-33`
- 选择导入方式：
  - 本地导入：打开系统文件选择器，导入 `.js` 或 `.zip` 插件包。
    - 本地导入调用：`src/renderer/src/components/Settings/plugins.vue:397-400`
  - 在线导入：输入 HTTP/HTTPS 下载地址，自动下载并安装。
    - 在线导入调用与 URL 校验：`src/renderer/src/components/Settings/plugins.vue:401-421`
- 安装结果处理与刷新插件列表：`src/renderer/src/components/Settings/plugins.vue:423-449`。

## 插件列表与操作

- 列表展示：名称、版本、作者、描述、支持音源集合。
  - 列表渲染：`src/renderer/src/components/Settings/plugins.vue:96-145`。
- 设为当前使用：为插件选择默认音源与音质（若未设定则取第一个音源与最高音质）。
  - 选择与存储逻辑：`src/renderer/src/components/Settings/plugins.vue:283-344`。
  - 存储字段：`pluginId`、`pluginName`、`supportedSources`、`selectSources`、`selectQuality`（保存在 `LocalUserDetail`）。`src/renderer/src/store/LocalUserDetail.ts:21-31`、`src/renderer/src/store/LocalUserDetail.ts:98-106`
- 卸载插件：从本地删除插件记录并刷新列表，若当前使用插件被卸载则重置选择。`src/renderer/src/components/Settings/plugins.vue:451-494`
- 插件日志：打开“日志”弹窗，查看插件运行输出。`src/renderer/src/components/Settings/plugins.vue:149-220`

## 音源与音质配置

- 每插件可声明若干音源（`supportedSources`），每音源支持若干音质（`qualitys`）。
- 用户选择记录：
  - 当前音源与音质：`LocalUserDetail.userInfo.selectSources`、`LocalUserDetail.userInfo.selectQuality`。
  - 每音源的音质偏好：`LocalUserDetail.userInfo.sourceQualityMap`（下载成功后自动更新）。
  - 参考：`src/renderer/src/utils/playlist/playlistManager.ts:44-51`、`src/renderer/src/utils/audio/download.ts:214-216`。

## 适配与兼容说明

- LX 插件可能不完全覆盖 CR 能力，如歌词、封面或部分音质类型；实际支持以插件声明与运行日志为准。
- 若某音质不可用，系统会回退为歌曲支持的最高可用音质并提示：`src/renderer/src/utils/audio/download.ts:182-193`。

