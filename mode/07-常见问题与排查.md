# 常见问题与排查（FAQ）

## 插件安装失败

- 现象：在线导入提示 URL 无效或下载失败；本地导入后状态无变化。
- 排查：
  - 检查 URL 是否为有效 HTTP/HTTPS，插件文件扩展是否为 `.js`/`.zip`。
    - 验证逻辑：`src/renderer/src/components/Settings/plugins.vue:408-415`。
  - 查看“插件日志”弹窗获取错误信息：`src/renderer/src/components/Settings/plugins.vue:149-220`。
  - 重试“刷新”以重新加载插件列表：`src/renderer/src/components/Settings/plugins.vue:496-499`。

## 无音源或无法播放

- 现象：搜索页提示“请配置音源”，或播放按钮无反应。
- 排查：
  - 在插件管理中确认“使用”已选择插件，且其 `supportedSources` 非空：`src/renderer/src/components/Settings/plugins.vue:291-301`。
  - 在搜索页使用当前音源检索：`src/renderer/src/views/music/search.vue:116-127`。

## 歌词不显示或不同步

- 现象：桌面歌词窗口无文本或切行不同步。
- 排查：
  - 桥接会优先尝试 TTML，失败则回退到 CR/QRC/LRC；检查网络与插件歌词能力：`src/renderer/src/utils/lyrics/desktopLyricBridge.ts:96-151`。
  - 检查桌面歌词已“显示”且未被锁定（锁定后仅样式更新不显示工具）：`src/main/events/lyric.ts:32-73`、`src/web/lyric.html:710-717`。

## 下载失败或音质不可用

- 现象：选择某音质后失败或提示已自动回退。
- 排查：
  - 音质回退机制会将不可用音质改为歌曲最高可用音质：`src/renderer/src/utils/audio/download.ts:182-193`。
  - 下载执行失败时查看提示或通知内容并检查目录权限：`src/renderer/src/utils/audio/download.ts:196-214`。

## 系统媒体控制（SMTC）异常

- 现象：系统播放/暂停按钮不生效或状态不同步。
- 排查：
  - 确保全局音频组件已初始化并调用了 SMTC 安装：`src/renderer/src/components/Play/GlobalAudio.vue:23-26`、`src/renderer/src/utils/audio/globalControls.ts:14-28`。
  - 若组件切换导致注销，重新挂载时会同步一次状态：`src/renderer/src/utils/audio/globalControls.ts:14-28`。

## 本地音乐无法索引或播放

- 现象：扫描后列表为空或播放提示错误。
- 排查：
  - 检查选择的目录与扩展名支持集合：`src/main/events/localMusic.ts:9`。
  - 通过 `getUrlById` 获取 URL 并确认可播放：`src/preload/index.ts:212-213`。

