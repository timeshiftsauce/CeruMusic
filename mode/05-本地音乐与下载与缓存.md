# 本地音乐与下载与缓存

## 目录设置

- 缓存目录：用于歌曲播放缓存；下载目录：用于保存已下载音乐。
- 设置入口：设置 → 存储目录配置；选择/打开/重置，并显示目录大小。
  - 代码参考：`src/renderer/src/components/Settings/DirectorySettings.vue:1-75`、`src/renderer/src/components/Settings/DirectorySettings.vue:97-116`、`src/renderer/src/components/Settings/DirectorySettings.vue:121-131`。
- 主进程目录操作：选择目录、打开目录、保存与重置由主进程处理（IPC）。
  - 预加载 API：`src/preload/index.ts:179-191`、`src/preload/index.ts:181-190`。

## 本地音乐

- 选择扫描目录并索引本地音乐文件（支持常见音频扩展）。
- 预加载 API：
  - 选择目录、扫描与获取列表：`src/preload/index.ts:193-214`。
  - 按 ID 获取本地文件播放 URL：`src/preload/index.ts:212-213`。
- 主进程扩展名支持集合：`src/main/events/localMusic.ts:9`。

## 下载与标签写入

- 下载流程：选择音质 → 获取歌词（CR/QRC/LRC）→ 写入标签（可配置写入项）→ 保存到下载目录。
  - 下载与音质选择：`src/renderer/src/utils/audio/download.ts:155-173`。
  - 音质回退与提示：`src/renderer/src/utils/audio/download.ts:182-193`。
  - 执行下载与标签写入参数：`src/renderer/src/utils/audio/download.ts:196-203`。
- 标签写入项设置：标题/艺术家/专辑/封面/歌词开关，默认全开启。
  - 设置存储：`src/renderer/src/store/Settings.ts:24-33`、`src/renderer/src/store/Settings.ts:65-74`。

## 播放列表导出/导入/分享

- 导出到文件（`.cpl`）、复制到剪贴板、从文件或剪贴板导入；内置 AES 加密防止误读。
  - 导出与复制：`src/renderer/src/utils/playlist/playlistExportImport.ts:43-76`、`src/renderer/src/utils/playlist/playlistExportImport.ts:82-96`。
  - 导入与校验：`src/renderer/src/utils/playlist/playlistExportImport.ts:103-137`、`src/renderer/src/utils/playlist/playlistExportImport.ts:143-178`。

