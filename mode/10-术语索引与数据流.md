# 术语索引与数据流

## 术语

- 插件（Plugin）：提供音源能力（搜索、歌词、封面、播放 URL、下载）。
- 音源（Source）：音乐平台或数据来源标识（如 `wy`、`tx`、`kg`、`local`）。
- 音质（Quality）：如 `128k`、`192k`、`320k`、`flac`、`flac24bit`、`hires`。
- 播放列表（Playlist）：当前播放队列，保存在本地存储。
- 歌单（SongList）：平台侧的歌单实体，用于批量添加或替换播放列表。

## 数据流总览

- 渲染层 → 预加载 → 主进程服务 → 插件：
  - 统一调用口：`window.api.music.requestSdk(api, args)`。
    - 预加载暴露：`src/preload/index.ts:36-39`。
    - 主进程服务路由：`src/main/services/musicSdk/service.ts:1-16`。
  - 典型请求：
    - 搜索：`search`，`src/renderer/src/views/music/search.vue:121-127`。
    - 获取歌曲 URL：`getMusicUrl`，`src/renderer/src/utils/playlist/playlistManager.ts:60-74`。
    - 获取歌词：`getLyric`，`src/renderer/src/utils/lyrics/desktopLyricBridge.ts:117-151`。
    - 下载单曲：`downloadSingleSong`，`src/renderer/src/utils/audio/download.ts:196-203`。

- 播放控制与系统媒体：
  - 全局音频组件：`src/renderer/src/components/Play/GlobalAudio.vue:172-186`。
  - 系统媒体控制（Media Session）：`src/renderer/src/utils/audio/useSmtc.ts:87-111`（初始化）、`src/renderer/src/utils/audio/useSmtc.ts:116-144`（动作）。
  - 全局安装与事件分发：`src/renderer/src/utils/audio/globalControls.ts:1-28`。

- 桌面歌词桥接：
  - 歌词解析与索引：`src/renderer/src/utils/lyrics/desktopLyricBridge.ts:78-179`、`src/renderer/src/utils/lyrics/desktopLyricBridge.ts:20-40`。
  - IPC 广播到歌词窗口：`src/main/events/lyric.ts:49-106`。

- 本地音乐：
  - 选择目录与扫描列表：`src/preload/index.ts:193-214`。
  - 获取本地 URL 并播放：`src/renderer/src/utils/playlist/playlistManager.ts:36-43`。

- 自动更新与 AI 流：
  - 自动更新预加载 API 与事件：`src/preload/index.ts:128-167`；渲染层服务：`src/renderer/src/services/autoUpdateService.ts:51-81`、`src/renderer/src/services/autoUpdateService.ts:91-131`。
  - AI 流式事件：预加载 `src/preload/index.ts:55-72`；渲染层监听与渲染 `src/renderer/src/components/AI/FloatBall.vue:237-290`。

## 状态与持久化

- 用户信息与播放列表：`localStorage.userInfo` 与 `localStorage.songList`，由 `LocalUserDetail` 管理。
  - 初始化与监听：`src/renderer/src/store/LocalUserDetail.ts:15-43`、`src/renderer/src/store/LocalUserDetail.ts:44-63`。
- 应用设置：`localStorage.appSettings`，由 `Settings` 管理。
  - 默认与保存：`src/renderer/src/store/Settings.ts:24-33`、`src/renderer/src/store/Settings.ts:65-86`。

